<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_pipe (lwt-pipe.Lwt_pipe)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">lwt-pipe</a> &#x00BB; Lwt_pipe</nav><h1>Module <code>Lwt_pipe</code></h1><h2 id="pipes,-readers,-writers"><a href="#pipes,-readers,-writers" class="anchor"></a>Pipes, Readers, Writers</h2><p>Stream processing using:</p><ul><li>Pipe: a possibly buffered channel that can act as a reader or as a writer</li><li>Reader: accepts values, produces effects</li><li>Writer: yield values</li></ul><p>Examples:</p><pre><code class="ml">#require &quot;lwt&quot;;;

module P = Lwt_pipe;;

let p1 =
  P.of_list CCList.(1 -- 100)
  |&gt; P.Reader.map ~f:string_of_int;;

Lwt_io.with_file ~mode:Lwt_io.output &quot;/tmp/foo&quot;
  (fun oc -&gt;
     let p2 = P.IO.write_lines oc in
     P.connect ~ownership:`InOwnsOut p1 p2;
     P.wait p2
  );;</code></pre><p><b>status: experimental</b></p><nav class="toc"><ul><li><a href="#write-only-interface-and-combinators">Write-only Interface and Combinators</a></li><li><a href="#read-only-interface-and-combinators">Read-only Interface and Combinators</a></li><li><a href="#conversions">Conversions</a></li><li><a href="#basic-io-wrappers">Basic IO wrappers</a></li></ul></nav></header><dl><dt class="spec exception" id="exception-Closed"><a href="#exception-Closed" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Closed</span></code></dt></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>('a, +'perm) t</span></code><code> <span class="keyword">constraint</span> <span class="type-var">'perm</span> = <span>[&lt; `r <span>| `w</span> ]</span></code></dt><dd><p>A pipe between producers of values of type 'a, and consumers of values of type 'a.</p></dd></dl><dl><dt class="spec type" id="type-pipe"><a href="#type-pipe" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'perm) pipe</span></code><code> = <span><span>(<span class="type-var">'a</span>, <span class="type-var">'perm</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec type" id="type-read_timeout_result"><a href="#type-read_timeout_result" class="anchor"></a><code><span class="keyword">type</span> <span>'a read_timeout_result</span></code><code> = </code><table class="variant"><tr id="type-read_timeout_result.Pipe_closed" class="anchored"><td class="def constructor"><a href="#type-read_timeout_result.Pipe_closed" class="anchor"></a><code>| </code><code><span class="constructor">Pipe_closed</span></code></td></tr><tr id="type-read_timeout_result.Nothing_available" class="anchored"><td class="def constructor"><a href="#type-read_timeout_result.Nothing_available" class="anchor"></a><code>| </code><code><span class="constructor">Nothing_available</span></code></td></tr><tr id="type-read_timeout_result.Timeout" class="anchored"><td class="def constructor"><a href="#type-read_timeout_result.Timeout" class="anchor"></a><code>| </code><code><span class="constructor">Timeout</span></code></td></tr><tr id="type-read_timeout_result.Data_available" class="anchored"><td class="def constructor"><a href="#type-read_timeout_result.Data_available" class="anchor"></a><code>| </code><code><span class="constructor">Data_available</span> <span class="keyword">of</span> <span class="type-var">'a</span></code></td><td class="doc"><p>Return type for the <code>read_with_timeout</code> function</p></td></tr></table></dt></dl><dl><dt class="spec value" id="val-keep"><a href="#val-keep" class="anchor"></a><code><span class="keyword">val</span> keep : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>keep p fut</code> adds a pointer from <code>p</code> to <code>fut</code> so that <code>fut</code> is not garbage-collected before <code>p</code></p></dd></dl><dl><dt class="spec value" id="val-is_closed"><a href="#val-is_closed" class="anchor"></a><code><span class="keyword">val</span> is_closed : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>close p</code> closes <code>p</code>, which will not accept input anymore. This sends <code>End</code> to all readers connected to <code>p</code></p></dd></dl><dl><dt class="spec value" id="val-close_nonblock"><a href="#val-close_nonblock" class="anchor"></a><code><span class="keyword">val</span> close_nonblock : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Same as <a href="index.html#val-close"><code>close</code></a> but does not wait for completion of dependent tasks</p></dd></dl><dl><dt class="spec value" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span class="keyword">val</span> wait : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Evaluates once the pipe closes</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>?&#8288;on_close:<span>(unit <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>?&#8288;max_size:int</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'perm</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Create a new pipe.</p><dl><dt>parameter on_close</dt><dd><p>called when the pipe is closed</p></dd></dl><dl><dt>parameter max_size</dt><dd><p>size of internal buffer. Default 0.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span class="keyword">val</span> connect : <span>?&#8288;ownership:<span>[ `None <span>| `InOwnsOut</span> <span>| `OutOwnsIn</span> ]</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span>[&gt; `w ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>connect p1 p2</code> forwards every item output by <code>p1</code> into <code>p2</code>'s input until <code>p1</code> is closed.</p><dl><dt>parameter own</dt><dd><p>determines which pipes owns which (the owner, when it closes, also closes the ownee)</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-link_close"><a href="#val-link_close" class="anchor"></a><code><span class="keyword">val</span> link_close : <span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>after:<span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="index.html#type-t">t</a></span></span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>link_close p ~after</code> will close <code>p</code> when <code>after</code> closes. if <code>after</code> is closed already, closes <code>p</code> immediately</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> option</span> Lwt.t</span></code></dt><dd><p>Read the next value from a Pipe</p></dd></dl><dl><dt class="spec value" id="val-read_with_timeout"><a href="#val-read_with_timeout" class="anchor"></a><code><span class="keyword">val</span> read_with_timeout : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>timeout:<span>float option</span></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> <a href="index.html#type-read_timeout_result">read_timeout_result</a></span> Lwt.t</span></code></dt><dd><p><code>read_with_timeout p ~timeout</code> read the next value from a Pipe, optionally waiting for at most a number of seconds passed with the <code>timeout</code> parameter.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `w ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p>Returns <code>false</code> if the pipe is closed</p></dd></dl><dl><dt class="spec value" id="val-write_exn"><a href="#val-write_exn" class="anchor"></a><code><span class="keyword">val</span> write_exn : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `w ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><dl><dt>raises Closed</dt><dd><p>if the writer is closed</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-write_list"><a href="#val-write_list" class="anchor"></a><code><span class="keyword">val</span> write_list : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `w ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p>Returns <code>false</code> if the pipe is closed</p></dd></dl><dl><dt class="spec value" id="val-write_list_exn"><a href="#val-write_list_exn" class="anchor"></a><code><span class="keyword">val</span> write_list_exn : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `w ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><dl><dt>raises Closed</dt><dd><p>if the writer is closed</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-to_stream"><a href="#val-to_stream" class="anchor"></a><code><span class="keyword">val</span> to_stream : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt_stream.t</span></code></dt><dd><p><code>to_stream p</code> returns a stream with the content from <code>p</code>. The stream will close when <code>p</code> closes.</p></dd></dl><dl><dt class="spec value" id="val-of_stream"><a href="#val-of_stream" class="anchor"></a><code><span class="keyword">val</span> of_stream : <span><span class="type-var">'a</span> Lwt_stream.t</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>of_stream s</code> reads from <code>s</code>. The returned pipe will close when <code>s</code> closes.</p></dd></dl><section><header><h3 id="write-only-interface-and-combinators"><a href="#write-only-interface-and-combinators" class="anchor"></a>Write-only Interface and Combinators</h3></header><div class="spec module" id="module-Writer"><a href="#module-Writer" class="anchor"></a><code><span class="keyword">module</span> <a href="Writer/index.html">Writer</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="read-only-interface-and-combinators"><a href="#read-only-interface-and-combinators" class="anchor"></a>Read-only Interface and Combinators</h3></header><div class="spec module" id="module-Reader"><a href="#module-Reader" class="anchor"></a><code><span class="keyword">module</span> <a href="Reader/index.html">Reader</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="conversions"><a href="#conversions" class="anchor"></a>Conversions</h3></header><dl><dt class="spec type" id="type-lwt_klist"><a href="#type-lwt_klist" class="anchor"></a><code><span class="keyword">type</span> <span>'a lwt_klist</span></code><code> = <span><span>[ `Nil <span><span>| `Cons</span> of <span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="index.html#type-lwt_klist">lwt_klist</a></span></span> ]</span> Lwt.t</span></code></dt></dl><dl><dt class="spec value" id="val-of_list"><a href="#val-of_list" class="anchor"></a><code><span class="keyword">val</span> of_list : <span><span class="type-var">'a</span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="Reader/index.html#type-t">Reader.t</a></span></code></dt><dt class="spec value" id="val-of_array"><a href="#val-of_array" class="anchor"></a><code><span class="keyword">val</span> of_array : <span><span class="type-var">'a</span> array</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="Reader/index.html#type-t">Reader.t</a></span></code></dt><dt class="spec value" id="val-of_string"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : string <span>&#45;&gt;</span> <span>char <a href="Reader/index.html#type-t">Reader.t</a></span></code></dt><dt class="spec value" id="val-of_lwt_klist"><a href="#val-of_lwt_klist" class="anchor"></a><code><span class="keyword">val</span> of_lwt_klist : <span><span class="type-var">'a</span> <a href="index.html#type-lwt_klist">lwt_klist</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="Reader/index.html#type-t">Reader.t</a></span></code></dt><dt class="spec value" id="val-to_list_rev"><a href="#val-to_list_rev" class="anchor"></a><code><span class="keyword">val</span> to_list_rev : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> Lwt.t</span></code></dt><dt class="spec value" id="val-to_list"><a href="#val-to_list" class="anchor"></a><code><span class="keyword">val</span> to_list : <span><span>(<span class="type-var">'a</span>, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> Lwt.t</span></code></dt><dt class="spec value" id="val-to_buffer"><a href="#val-to_buffer" class="anchor"></a><code><span class="keyword">val</span> to_buffer : Buffer.t <span>&#45;&gt;</span> <span><span>(char, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-to_buffer_str"><a href="#val-to_buffer_str" class="anchor"></a><code><span class="keyword">val</span> to_buffer_str : <span>?&#8288;sep:string</span> <span>&#45;&gt;</span> Buffer.t <span>&#45;&gt;</span> <span><span>(string, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <span><span>(char, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dt class="spec value" id="val-join_strings"><a href="#val-join_strings" class="anchor"></a><code><span class="keyword">val</span> join_strings : <span>?&#8288;sep:string</span> <span>&#45;&gt;</span> <span><span>(string, <span>[&gt; `r ]</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>string Lwt.t</span></code></dt><dt class="spec value" id="val-to_lwt_klist"><a href="#val-to_lwt_klist" class="anchor"></a><code><span class="keyword">val</span> to_lwt_klist : <span><span class="type-var">'a</span> <a href="Reader/index.html#type-t">Reader.t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-lwt_klist">lwt_klist</a></span></code></dt><dd><p>Iterates on the reader. Errors are ignored (but stop the list).</p></dd></dl></section><section><header><h3 id="basic-io-wrappers"><a href="#basic-io-wrappers" class="anchor"></a>Basic IO wrappers</h3></header><div class="spec module" id="module-IO"><a href="#module-IO" class="anchor"></a><code><span class="keyword">module</span> <a href="IO/index.html">IO</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>